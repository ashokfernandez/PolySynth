# PolySynth Automated Multi-Platform Release Pipeline Plan

Status date: 2026-02-20

## Goal

Ship a tag-driven GitHub Actions release pipeline that publishes:
- macOS installer (`.pkg`) with quarantine cleanup
- Windows VST3 archive (`.zip`)
- dynamic download links for GitHub Pages

## Task Checklist

- [x] **S1: Versioning Source of Truth**
  - Add root `VERSION`.
  - Add `just set-version <version>`.
  - Sync version into desktop `config.h`, `CMakeLists.txt`, and Windows `main.rc`.
  - Verification: run `just set-version 1.2.0` and confirm files updated.

- [x] **S2: Release Build Recipes**
  - Add `just plugin-release-mac`.
  - Add `just plugin-release-win`.
  - Create scripts under `scripts/tasks/` and route through `scripts/cli.sh`.
  - Verification: scripts stage deterministic artifacts.

- [x] **S3: macOS Installer Packaging**
  - Add `scripts/tasks/create_pkg.sh`.
  - Stage AU/VST3 payload and postinstall quarantine removal script.
  - Produce unsigned `.pkg` artifact.
  - Verification: package build succeeds and payload paths are correct.

- [x] **S4: CI Tag Trigger + Release Jobs**
  - Extend `.github/workflows/ci.yml` to trigger release pipeline on tags `v*.*.*`.
  - Add `build-macos` and `build-windows` jobs gated by `native-dsp-tests`.
  - Upload release artifacts from each job.
  - Verification: workflow graph shows safety gate -> release build jobs for tag refs.

- [x] **S5: GitHub Release Publish Job**
  - Add release aggregation job using `softprops/action-gh-release`.
  - Attach macOS `.pkg` and Windows `.zip`.
  - Enable autogenerated release notes.
  - Verification: tag run creates release with both assets.

- [x] **S6: Pages Download Metadata**
  - Add script to generate `docs/downloads.json` from latest GitHub release assets.
  - Integrate into pages packaging step in CI.
  - Verification: `downloads.json` appears in deployed docs artifact.

- [x] **S7: Pages Download UI**
  - Add download section (OS-aware links) to generated docs page source.
  - Keep implementation in generator path so CI regeneration does not overwrite manual edits.
  - Verification: local generated page references `downloads.json` and shows buttons.

- [x] **S8: README Release UX**
  - Add latest release badge.
  - Add install guidance for macOS and Windows security prompts.
  - Verification: README has clear release/install section with links.

- [x] **S9: Validation Run**
  - Run focused checks for changed scripts/workflow/docs generation.
  - Provide any failure log path from `.artifacts/logs/...` if encountered.

- [x] **S10: Retrospective Note**
  - Append Problem/Action/Lesson entry to the existing sprint retrospective file in `plans/`.

## Execution Log

- 2026-02-20: Plan created.
- 2026-02-20: S1 completed (`VERSION` + `just set-version` + synced desktop version fields).
- 2026-02-20: S2 completed (`just plugin-release-mac` / `just plugin-release-win` recipes and scripts).
- 2026-02-20: S3 completed (`scripts/tasks/create_pkg.sh` + `just plugin-package-mac`).
- 2026-02-20: S4/S5 completed (tag-triggered macOS + Windows build jobs and GitHub release publishing in CI).
- 2026-02-20: S6 completed (`scripts/tasks/generate_downloads_json.py` + CI integration to emit `docs/downloads.json`).
- 2026-02-20: S7 completed (download section + OS-aware release links in docs page source and generated template).
- 2026-02-20: S8 completed (README release badge and installation guide updates).
- 2026-02-20: S9 completed (syntax checks for shell/python/workflow + downloads JSON validation).
- 2026-02-20: S10 completed (Problem/Action/Lesson appended to `plans/SPRINT_RETROSPECTIVE_NOTES.md`).
